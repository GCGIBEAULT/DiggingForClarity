<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digging For Clarity</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background: #f9f9f9; }
    .card { background: #fff; padding: 1em; border-radius: 8px; box-shadow: 0 0 4px rgba(0,0,0,0.1); margin-bottom: 1em; }
    .line { display: flex; gap: 8px; align-items: center; margin-bottom: 6px; }
    input[type="text"], input[type="number"], select { padding: 4px; }
    button { padding: 4px 8px; background: #003366; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .tab { display: inline-block; padding: 6px 12px; margin-right: 4px; background: #eee; border-radius: 4px; cursor: pointer; }
    .tab.active { background: #003366; color: #fff; }
    .small { font-size: 0.9em; color: #333; }
  </style>
</head>
<body>

<header class="card">
  <h1>Digging For Clarity</h1>
  <p class="small">Drama-free news, weather, and community updates with modular clarity.</p>
</header>

<main>
  <div class="card">
    <h2>IOIOIO Budget Starter</h2>
    <p class="small">Manual entry only. No autofill. No export. Just clarity.</p>


    <!-- Pay Period Tabs -->
    <div class="paytabs">
      <div class="tab active" data-pay="1" onclick="switchPay('1')">1st</div>
      <div class="tab" data-pay="15" onclick="switchPay('15')">15th</div>
    </div>

    <!-- Summary -->
    <div class="small" style="margin-top: 10px;">
      Income: <strong id="incomeVal">$0</strong> â€¢ Expenses: <strong id="expensesVal">$0</strong>
    </div>

    <!-- Lines Block -->
    <div id="lines" style="margin-top:8px"></div>

    <!-- Controls -->
    <div style="display:flex; justify-content:space-between; margin-top:10px;">
      <button onclick="addLine()">+ Add line</button>
      <div class="small" id="leftoverText">
        Leftover: <strong id="leftoverVal">$0</strong> â€¢ <span id="perDayVal">$0/day</span>
      </div>
    </div>
  </div>
</main>

<script>
const KEY = 'dfc:blank:ioioio:v1';
const defaults = {
  active: '1',
  paychecks: {
    '1': { income: 1800, lines: [] },
    '15': { income: 1200, lines: [] }
  }
};

let state = JSON.parse(localStorage.getItem(KEY) || 'null') || defaults;

function saveState(){
  localStorage.setItem(KEY, JSON.stringify(state));
}

function ordinalize(n){
  n = parseInt(n);
  if (!n || n < 1 || n > 31) return '';
  const suffix = (n % 10 === 1 && n !== 11) ? 'st' :
                 (n % 10 === 2 && n !== 12) ? 'nd' :
                 (n % 10 === 3 && n !== 13) ? 'rd' : 'th';
  return `${n}${suffix}`;
}

function render(){
  const pay = state.paychecks[state.active];
  const linesEl = document.getElementById('lines');
  linesEl.innerHTML = '';

  const transDayRaw = document.getElementById('transDayInput')?.value || '';
  const transDay = ordinalize(transDayRaw);

pay.lines.forEach(line => {
  const el = document.createElement('div');
  el.className = 'line';

  const transDay = ordinalize(line.trans_day);
  const typeLabel = line.type + (transDay ? ` (${transDay})` : '');

  el.innerHTML = `
    <input value="${line.name}" onchange="line.name=this.value;saveState();render()">
    <input type="number" value="${line.amount}" onchange="line.amount=Number(this.value)||0;saveState();render()">
    <input type="number" value="${line.trans_day || ''}" min="1" max="31" placeholder="Day" onchange="line.trans_day=Number(this.value)||'';saveState();render()" style="width:50px">
    <span><strong>${typeLabel}</strong></span>
    <button onclick="const url=prompt('Vendor URL:',line.vendor_url||'');if(url!==null){line.vendor_url=url.trim();saveState();render()}">${line.vendor_url ? 'ðŸ”—' : '+'}</button>
    <button onclick="if(confirm('Remove?')){pay.lines=pay.lines.filter(l=>l.id!==line.id);saveState();render()}">âœ•</button>
  `;

  linesEl.appendChild(el);
});


  document.getElementById('incomeVal').textContent = `$${pay.income}`;
  const expenses = pay.lines.reduce((sum, l) => sum + l.amount, 0);
  document.getElementById('expensesVal').textContent = `$${expenses}`;
  const leftover = pay.income - expenses;
  document.getElementById('leftoverVal').textContent = `$${leftover}`;
  document.getElementById('perDayVal').textContent = `${(leftover/15).toFixed(0)}/day`;
}

function addLine(){
  const id = 'n' + Date.now();
  state.paychecks[state.active].lines.push({
    id,
    name: 'New item',
    amount: 0,
    type: 'offline',
    trans_day: '',
    vendor_url: ''
  });
  saveState();
  render();
}


function switchPay(p){
  state.active = p;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.tab[data-pay="${p}"]`).classList.add('active');
  render();
}

render();
</script>

</body>
</html>

