<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Digging For Clarity â€” Private Lab</title>
  <link rel="icon" href="footer_logo.png" type="image/png">
  <link rel="stylesheet" href="style.css">
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--accent:#003366;--muted:#6b7280}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Georgia,serif;background:var(--bg);margin:0;color:#0b1220}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    .masthead{text-align:center;margin-top:28px}
    .masthead h1{font-family:Georgia,serif;color:var(--accent);font-size:2.4rem;margin:0}
    .masthead p{color:var(--muted);margin:6px 0 18px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 420px}}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 4px 14px rgba(7,12,20,.06)}
    .small{font-size:0.95rem;color:var(--muted)}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border:0;border-radius:8px;cursor:pointer}
    #budgetRoot{min-height:220px;display:flex;flex-direction:column;gap:8px}
    .paytabs{display:flex;gap:8px}
    .tab{flex:1;padding:10px;border-radius:8px;text-align:center;background:#f0f4f8;color:#254a68;font-weight:700;cursor:pointer}
    .tab.active{background:var(--accent);color:#fff}
    .line{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;background:#fbfdff}
    .line input[type="text"], .line input[type="number"], .line select{border:0;background:transparent;outline:none;font-size:15px}
    .line input[type="number"]{width:90px}
    .stats{display:flex;gap:12px;align-items:center;margin-top:8px}
    footer{margin-top:28px;text-align:center;color:var(--muted);font-size:0.95rem}
    @media (max-width:520px){
      .line{flex-direction:column;align-items:flex-start}
      .line input[type="number"]{width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="masthead">
      <h1>Digging For Clarity</h1>
      <p class="small">Drama-free news, weather, and community updates with modular clarity.</p>
    </header>

    <main class="grid">
      <section class="card" id="budgetRoot" aria-labelledby="budgetTitle">
        <h2 id="budgetTitle" class="small">Minimal bills card</h2>

        <div class="paytabs" role="tablist" aria-label="Paychecks">
          <!-- Example tabs 1..3 and 15; markup relies on dataset.pay and window.switchPay -->
          <div class="tab" role="tab" tabindex="0" data-pay="1" onclick="switchPay('1')">Pay 1</div>
          <div class="tab" role="tab" tabindex="0" data-pay="2" onclick="switchPay('2')">Pay 2</div>
          <div class="tab" role="tab" tabindex="0" data-pay="3" onclick="switchPay('3')">Pay 3</div>
          <div class="tab" role="tab" tabindex="0" data-pay="15" onclick="switchPay('15')">Pay 15</div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div>
            <div class="small">Income</div>
            <div id="incomeVal" style="font-weight:700">$0</div>
          </div>
          <div>
            <div class="small">Expenses</div>
            <div id="expensesVal" style="font-weight:700">$0</div>
          </div>
          <div>
            <div class="small">Leftover</div>
            <div id="leftoverVal" style="font-weight:700">$0</div>
          </div>
          <div>
            <div class="small">Per day</div>
            <div id="perDayVal" style="font-weight:700">0/day</div>
          </div>
          <div>
            <button class="btn" onclick="addLine()">Add line</button>
          </div>
        </div>

        <div id="lines" style="margin-top:12px"></div>
      </section>

      <aside class="card">
        <h3 class="small">Notes</h3>
        <p class="small">Editable line items; Add line and Pay 15 should be functional. This full page replaces the faulty nested script area.</p>
      </aside>
    </main>

    <footer>
      <div class="small">Built with editorial restraint.</div>
    </footer>
  </div>

  <script>
  (function(){
    const KEY = 'dfc:blank:ioioio:v7';
    const defaults = {
      active: '1',
      paychecks: {
        '1': { income: 1800, lines: [{ id: 'demo1', name: 'Rent', amount: 1200, type: 'auto', trans_day: 27, vendor_url: '' }] },
        '2': { income: 1200, lines: [] },
        '3': { income: 0, lines: [] },
        '15': { income: 1200, lines: [] }
      }
    };

    let state = JSON.parse(localStorage.getItem(KEY) || 'null') || defaults;

    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    function ordinalize(n){
      n = parseInt(n);
      if (!n || n < 1 || n > 31) return '';
      const suffix = (n % 10 === 1 && n !== 11) ? 'st' : (n % 10 === 2 && n !== 12) ? 'nd' : (n % 10 === 3 && n !== 13) ? 'rd' : 'th';
      return `${n}${suffix}`;
    }

    function switchPay(pay){
      state.active = String(pay);
      saveState();
      render();
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.pay === String(pay)));
    }

    function render(){
      const pay = state.paychecks[state.active] || { income:0, lines:[] };
      const linesEl = document.getElementById('lines');
      linesEl.innerHTML = '';

      pay.lines.forEach(line => {
        const el = document.createElement('div');
        el.className = 'line';

        const transDay = ordinalize(line.trans_day);

        el.innerHTML = `
          <input type="text" class="line-name" value="${escapeHtml(line.name)}" aria-label="Line name" />
          <input type="number" class="line-amount" value="${Number(line.amount)||0}" aria-label="Amount" />
          <select class="line-type" aria-label="Type">
            <option value="auto"${line.type==='auto'?' selected':''}>Auto</option>
            <option value="offline"${line.type==='offline'?' selected':''}>Offline</option>
          </select>
          <input type="number" class="line-day" value="${line.trans_day || ''}" min="1" max="31" placeholder="Day" aria-label="Day" style="width:60px" />
          <span style="min-width:56px"><strong>${transDay}</strong></span>
          <button class="vendor-btn" title="Vendor URL">${line.vendor_url ? 'ðŸ”—' : '+'}</button>
          <button class="del-btn" title="Remove line">âœ•</button>
        `;

        const nameI = el.querySelector('.line-name');
        const amtI = el.querySelector('.line-amount');
        const sel = el.querySelector('.line-type');
        const dayI = el.querySelector('.line-day');
        const vendorB = el.querySelector('.vendor-btn');
        const delB = el.querySelector('.del-btn');

        nameI.addEventListener('change', ()=>{ line.name = nameI.value.trim(); saveState(); render(); });
        amtI.addEventListener('change', ()=>{ line.amount = Number(amtI.value)||0; saveState(); render(); });
        sel.addEventListener('change', ()=>{ line.type = sel.value; saveState(); render(); });
        dayI.addEventListener('change', ()=>{ line.trans_day = Number(dayI.value)||''; saveState(); render(); });
        vendorB.addEventListener('click', ()=>{ const url = prompt('Vendor URL:', line.vendor_url||''); if(url!==null){ line.vendor_url = url.trim(); saveState(); render(); }});
        delB.addEventListener('click', ()=>{ if(confirm('Remove?')){ state.paychecks[state.active].lines = state.paychecks[state.active].lines.filter(l => l.id !== line.id); saveState(); render(); }});

        linesEl.appendChild(el);
      });

      document.getElementById('incomeVal').textContent = `$${Number(pay.income)||0}`;
      const expenses = pay.lines.reduce((sum, l) => sum + (Number(l.amount)||0), 0);
      document.getElementById('expensesVal').textContent = `$${expenses}`;
      const leftover = (Number(pay.income)||0) - expenses;
      document.getElementById('leftoverVal').textContent = `$${leftover}`;
      document.getElementById('perDayVal').textContent = `${Math.round(leftover/15)}/day`;

      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.pay === state.active));
    }

    function addLine(){
      const id = 'n' + Date.now();
      const newLine = { id, name: 'New item', amount: 0, type: 'auto', trans_day: 1, vendor_url: '' };
      const pay = state.paychecks[state.active] || (state.paychecks[state.active] = { income:0, lines:[] });
      if (!Array.isArray(pay.lines)) pay.lines = [];
      pay.lines.push(newLine);
      saveState();
      render();
      // focus the newly added line's name input after render
      setTimeout(()=> {
        const lines = document.querySelectorAll('#lines .line');
        if (lines.length) {
          const last = lines[lines.length-1];
          const name = last.querySelector('.line-name');
          if (name) name.focus();
        }
      }, 10);
    }

    // small HTML escape for injection-safe values
    function escapeHtml(s){
      if (s === undefined || s === null) return '';
      return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    // expose minimal globals used by existing markup
    window.switchPay = switchPay;
    window.addLine = addLine;

    document.addEventListener('DOMContentLoaded', () => {
      // ensure tabs available to click and reflect state
      document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', ()=> switchPay(t.dataset.pay)));
      // if active missing create default
      if (!state.paychecks[state.active]) state.active = Object.keys(state.paychecks)[0] || '1';
      render();
    });
  })();
  </script>
</body>
</html>
```
